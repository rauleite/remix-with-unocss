# This is a basic workflow to help you get started with Actions
name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    
    # A workflow run is made up of one or more jobs that can run sequentially or in parallel
    jobs:
      # This workflow contains two jobs: "build" and "deploy"
      build:
        # The type of runner that the job will run on
        # runs-on: ubuntu-latest

        # Steps represent a sequence of tasks that will be executed as part of the job
        # steps:
          # - uses: actions/checkout@v2
          # - uses: actions/setup-node@v2
            # with:
              # node-version: '>=16.13'
          # - run: pnpm install
          # - run: pnpm run test:e2e  # Checks out your repository under $GITHUB_WORKSPACE, so your job can access it
            
      tests_e2e:
          name: Run end-to-end tests
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v3
            - uses: actions/setup-node@v3
              with:
                node-version: '>=16.13'
            # - name: Install dependencies
              # run: npm ci
            - name: Install dependencies
              run: pnpm install
            - name: Install playwright browsers
              run: pnpm exec playwright install --with-deps
            - name: Run tests
              # run: npx playwright test
              run: pnpm run test:e2e
      deploy:
        runs-on: ubuntu-latest
        name: Deploy
        steps:
          - uses: actions/checkout@v3
          - name: Publish
            uses: cloudflare/wrangler-action@2.2.1
            with:
              apiToken: ${{ secrets.CLOUDFLARE_WORKERS }}
