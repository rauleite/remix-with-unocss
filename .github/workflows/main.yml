# This is a basic workflow to help you get started with Actions
name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: 
     - main
# on: workflow_dispatch:
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  tests_e2e:
    runs-on: ubuntu-latest
    steps:
      # - name: Checkout and Node
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
        with:
          version: latest
          run_install: true
      - uses: actions/setup-node@v3
        with:
          node-version: '>=18'
          cache: 'pnpm'
      - run: pnpm -v
      - run: node -v
      # - run: pnpm install
      - run: pnpm dlx playwright install --with-deps
      - run: pnpm run test
  deploy:
    needs: tests_e2e
    runs-on: ubuntu-latest
    steps:
      # - name: Checkout and Wrangler
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
        with:
          run_install: true
          version: latest
      - uses: cloudflare/wrangler-action@2.0.0
        with:
          apiToken: ${{ secrets.CLOUDFLARE_WORKERS }}
          command: publish
